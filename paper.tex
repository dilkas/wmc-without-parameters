\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[UKenglish]{babel}
\usepackage[UKenglish]{isodate}
\usepackage{fullpage}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage[capitalise]{cleveref}
\usepackage{bm}
\usepackage{booktabs}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage[backgroundcolor=lightgray]{todonotes}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{conjecture}{Conjecture}
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}

\Crefname{property}{Property}{Properties}
\Crefname{condition}{Condition}{Conditions}
\creflabelformat{condition}{#2(#1)#3}

\DeclareMathOperator{\WMC}{WMC}
\DeclareMathOperator{\nWMC}{nWMC}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\End}{End}

\usetikzlibrary{cd}

\tikzset{
  Subset/.style={
    draw=none,
    every to/.append style={
      edge node={node [sloped, allow upside down, auto=false]{$\subset$}}}
  }
}

\title{On the Limitations of Weighted Model Counting}
\author{Paulius Dilkas}

\begin{document}
\maketitle

\section{Introduction}
% TODO: use \colon instead of :

% Feedback: What are the main claims, what are the main takeaways, intuitive
% [???] of theorems to follow. To do this, we appeal to algebraic constructions
% to define the main concepts for introducing measures on Boolean algebras.

%Contributions
%\begin{itemize}
%\item Equip polyadic algebras with a measure.
%\item Show that it is equivalent to WMC.
%\end{itemize}

% Big advantage: using algebras we can represent an incomplete state of
% knowledge, e.g., we know m(a \/ b), but not m(a) or m(b). In infinite BAs, one
% can have measure undefined for some elements.

\section{WMC as a Measure}

\subsection{Preliminaries}

\begin{definition} \label{def:ba}
  A \emph{Boolean algebra} is a tuple $(\mathbf{B}, \land, \lor, \neg, 0, 1)$ of
  a set $\mathbf{B}$ with operations $\land, \lor, \neg$ and elements $0, 1 \in
  \mathbf{B}$ such that the following axioms hold for all $a, b, \in
  \mathbf{B}$:
  \begin{itemize}
  \item both $\land$ and $\lor$ are associative and commutative;
  \item $a \lor (a \land b) = a$, and $a \land (a \lor b) = a$;
  \item $0$ is the identity of $\lor$, and $1$ is the identity of $\land$;
  \item $\lor$ distributes over $\land$ and vice versa;
  \item $a \lor \neg a = 1$, and $a \land \neg a = 0$.
  \end{itemize}

  Let $a, b \in \mathbf{B}$ be arbitrary. Let $\le$ be a partial order on
  $\mathbf{B}$ defined by $a \le b$ if $a = b \land a$ (or, equivalently, $a
  \lor b = b$), and let $a < b$ denote $a \le b$ and $a \ne b$.
\end{definition}

\todo[inline]{Which definition do I actually need?}
\begin{definition}[\cite{DBLP:books/daglib/0090259,levasseur2012applied}]
  An element $a \ne 0$ of a Boolean algebra $\mathbf{B}$ is an \emph{atom} if
  there is no $x \in \mathbf{B}$ such that $0 < x < a$. Equivalently, $a \ne 0$
  is an atom if, for all $x \in \mathbf{B}$, either $x \land a = a$ or $x \land
  a = 0$. A Boolean algebra is \emph{atomic} if for every $a \in \mathbf{B}
  \setminus \{0 \}$, there is an atom $x$ such that $x \le a$.
\end{definition}

\begin{lemma}[\cite{ganesh2006introduction}]
  For any two distinct atoms $a$, $b$ in a Boolean algebra, $a \land b = 0$.
\end{lemma}

\begin{lemma}[\cite{givant2008introduction}] \label{lemma:atomic}
  All finite Boolean algebras are atomic.
\end{lemma}

% TODO: we don't have to treat 0 as an exception we state that \/ of an empty
% set is 0 (and /\ of an empty set is 1).
% TODO: use bigvee and bigwedge directly with sets.
\begin{theorem} \label{thm:representation}
  Let $\mathbf{B}$ be a finite Boolean algebra. Then every $x \in \mathbf{B}
  \setminus \{ 0 \}$ can be uniquely expressed as
  \[
  x = \bigvee_{\text{atoms } a \le x} a.
  \]
\end{theorem}
\begin{proof}
  A simple consequence of the theorem that every finite Boolean algebra is
  isomorphic to a field of subsets of a set, where the cardinality of the set is
  equal to the number of atoms in the Boolean algebra.
\end{proof}

\todo[inline]{Remove the requirement for being strictly positive}
\begin{definition}[\cite{gaifman1964concerning}] \label{def:measure}
  A \emph{(strictly positive) measure} on a Boolean algebra $\mathbf{B}$ is a
  function $m : \mathbf{B} \to [0, 1]$ such that:
  \begin{enumerate}
  \item $m(1) = 1$, and $m(x) > 0$ for $x \ne
    0$; \label[property]{property:values}
  \item $m(x \lor y) = m(x) + m(y)$ for all $x, y \in \mathbf{B}$ whenever $x
    \land y = 0$. \label[property]{property:additive}
  \end{enumerate}
\end{definition}

% TODO: Feedback: Probably a good idea to explain how elements of the Boolean
% algebra map to models in WMC formulations. Probably do an example:
% 0.3 p; 0.2 q => M = <p, qbar> has weight o3 * (1-0.2)
% then it corresponds to an atom in an algebra defined over the language defined
% over propositions p and q.

\subsection{New Results}

\todo[inline]{Allow weight to be zero}
\begin{definition} \label{def:wmc}
  Let $\mathbf{B}$ be a finite Boolean algebra, and let $M \subseteq \mathbf{B}$
  be its set of atoms. Let $L \subseteq \mathbf{B}$ be such that every atom $m
  \in M$ can be uniquely expressed as $m = \bigwedge_{i \in I} l_i$ for some $\{
  l_i \}_{i \in I} \subseteq L$, and let $w : L \to \mathbb{R}_{>0}$ be
  arbitrary. The \emph{weighted model count} $\WMC : \mathbf{B} \to
  \mathbb{R}_{\ge 0}$ is defined as
  \[
    \WMC(a) = \begin{cases}
      0 & \text{if } a = 0 \\
      \prod_{i \in I} w(l_i) & \text{if } M \ni a = \bigwedge_{i \in I} l_i \\
      \sum_{i \in I} \WMC(m_i) & \text{if } \mathbf{B} \setminus (M \cup \{ 0
      \}) \ni a = \bigvee_{i \in I} m_i
    \end{cases}
  \]
  for any $a \in \mathbf{B}$. Furthermore, we define the \emph{normalised
    weighted model count} $\nWMC : \mathbf{B} \to [0, 1]$ as $\nWMC(a) =
  \frac{\WMC(a)}{\WMC(1)}$ for all $a \in \mathbf{B}$.
\end{definition}
% TODO: Feedback: maybe NWMC or WMC^*, as nWMC looks like a typo. Also clarify
% the relationship between NWMC and the probability induced by a WMC
% formulation, i.e., Pr_{\Delta, w}(q) = \frac{WMC(\Delta \land q,
% w)}{WMC(\Delta, w)}.

\begin{proposition}
  $\nWMC$ is a measure for any finite Boolean algebra $\mathbf{B}$.
\end{proposition}
\begin{proof}
  First, note that \cref{property:values} of \cref{def:measure} is satisfied by
  the definition of $\nWMC$. Next, in order to prove \cref{property:additive},
  let $x, y \in \mathbf{B}$ be such that $x \land y = 0$. We want to show that
  \[
    \nWMC(x \lor y) = \nWMC(x) + \nWMC(y)
  \]
  which is equivalent to
  \begin{equation} \label{eq:additivity_proof}
    \WMC(x \lor y) = \WMC(x) + \WMC(y).
  \end{equation}
  If, say, $x = 0$, then \cref{eq:additivity_proof} becomes
  \[
    \WMC(y) = \WMC(0) + \WMC(y) = \WMC(y)
  \]
  (and likewise for $y = 0$). Thus we can assume that $x \ne 0 \ne y$ and use
  \cref{thm:representation} to write
  \[
    x = \bigvee_{i \in I} x_i \quad \text{and} \quad y = \bigvee_{j \in J} y_j
  \]
  for some sequences of atoms $(x_i)_{i \in I}$ and $(y_j)_{j \in J}$. If
  $x_{i'} = y_{j'}$ for some $i' \in I$ and $j' \in J$, then
  \[
    x \land y = \bigvee_{i \in I} \bigvee_{j \in J} x_i \land y_j = x_{i'} \land
    y_{j'} \ne 0,
  \]
  contradicting the assumption. This is enough to show that
  \begin{align*}
    \WMC(x \lor y) &= \WMC\left( \left( \bigvee_{i \in I} x_i \right) \lor \left(\bigvee_{j \in J} y_j \right) \right) = \sum_{i \in I} \WMC(x_i) + \sum_{j \in J} \WMC(y_j) \\
                   &= \WMC(x) + \WMC(y),
  \end{align*}
  finishing the proof.
\end{proof}

% TODO: Feedback: Can you say something here about factorized vs non-factorized
% weight function definitions? That is, factorized is when w maps literals to
% R_>=0, non-factorized is when w maps models to R_>=0 and show:
% a) come up with nice example when non-factorized weights are intuitive
% b) what if weight functions are negative/complex?
% c) clarify that the factorized definition have is w.r.t. models, in case some
% one gets confused [It doesn't have to be, if the BA is not free -- P.]
% d) can you say something about WMI

\section{What Measures Are WMC-Computable?}

\subsection{WMC Requires Independent Literals}

% TODO: maybe I should gives this kind of a BA a name? A synonym of 'complete',
% perhaps.
% TODO: a special case for weight=0.

\begin{proposition}
  Let $\mathbf{B}$ be a finite measure algebra with measure $m : \mathbf{B} \to
  \mathbb{R}_{\ge 0}$. Let $L \subset \mathbf{B}$ be defined as
  \[
  L = \{ l_i \mid i \in [n] \} \cup \{ \neg l_i \mid i \in [n] \}
  \]
  for some $n \in \mathbb{N}$. Finally, assume that $\mathbf{B}$ has $2^n$
  atoms, where each atom $a \in \mathbf{B}$ is an infimum
  \[
    a = \bigwedge_{i=1}^n a_i
  \]
  such that $a_i \in \{ l_i, \neg l_i \}$ for $i \in [n]$. Then there exists a
  weight function $w : L \to \mathbb{R}_{>0}$ that makes $m$ a WMC measure if
  and only if
  \begin{equation} \label{eq:wmccondition}
  m(l \land l') = m(l)m(l')
  \end{equation}
  for all distinct $l, l' \in L$ such that $l \ne \neg l'$.
\end{proposition}

\begin{remark}
  Note that if $n = 1$, then \cref{eq:wmccondition} is vacuously satisfied and
  so any valid measure can be expressed as WMC.
\end{remark}

\begin{proof}
  Let us begin with the `if' part of the statement. Let $w : L \to
  \mathbb{R}_{>0}$ be defined by
  \begin{equation} \label{eq:assumption}
    w(l) = m(l)
  \end{equation}
  for all $l \in L$. We are going
  to show that $\nWMC = m$. First, note that $\nWMC(0) = 0 = m(0)$ by the
  definitions of both $\nWMC$ and $m$. Second, let
  \begin{equation} \label{eq:def_of_a}
    a = \bigwedge_{i=1}^n a_i
  \end{equation}
  be an atom in $\mathbf{B}$ such that $a_i \in \{ l_i, \neg l_i \}$ for all $i
  \in [n]$. Then
  \[
    \nWMC(a) = \frac{\WMC(a)}{\WMC(1)} = \frac{1}{\WMC(1)} \prod_{i=1}^n w(a_i)
    = \frac{1}{\WMC(1)} \prod_{i=1}^n m(a_i) = \frac{1}{\WMC(1)} m \left(
      \bigwedge_{i=1}^n a_i \right) = \frac{m(a)}{\WMC(1)}
  \]
  by \cref{def:wmc,eq:assumption,eq:wmccondition,eq:def_of_a}. Now we just need
  to show that $\WMC(1) = 1$. Indeed,
  \begin{align*}
    \WMC(1) &= \sum_{\text{atoms } a \in \mathbf{B}} \WMC(a) = \sum_{\text{atoms
      } a \in \mathbf{B}} \prod_{i=1}^n w(a_i) = \sum_{\text{atoms } a \in
      \mathbf{B}} \prod_{i=1}^n m(a_i) \\
    &= \sum_{\text{atoms } a \in
      \mathbf{B}} m \left( \bigwedge_{i=1}^n a_i \right) = \sum_{\text{atoms } a
      \in \mathbf{B}} m(a) = m \left( \bigvee_{\text{atoms } a \in \mathbf{B}}
    \right) = m(1) = 1.
  \end{align*}
  Finally, note that if $\nWMC$ and $m$ agree on all atoms, then they must also
  agree on all other non-zero elements of the Boolean algebra.

  For the other direction, we are given a weight function $w : L \to
  \mathbb{R}_{>0}$ that induces a measure $m = \nWMC : \mathbf{B} \to
  \mathbb{R}_{\ge 0}$, and we want to show that \cref{eq:wmccondition} is
  satisfied. Let $k_i, k_j \in L$ be such that $k_i \in \{ l_i, \neg l_i \}$,
  $k_j \in \{ l_j, \neg l_j \}$, and $i \ne j$. We will first prove an auxiliary
  result that
  \begin{equation} \label{eq:to_prove}
    m(k_i \land k_j) = m(k_i)m(k_j)
  \end{equation}
  is equivalent to
  \begin{equation} \label{eq:to_prove2}
    m(k_i \land k_j) \cdot m(\neg k_i \land \neg k_j) = m(k_i \land \neg k_j)
    \cdot m(\neg k_i \land k_j).
  \end{equation}
  First, note that $k_i$ can be expressed as
  \[
    k_i = (k_i \land k_j) \lor (k_i \land \neg k_j)
  \]
  with the condition that
  \[
    (k_i \land k_j) \land (k_i \land \neg k_j) = 0,
  \]
  so, by properties of a measure,
  \begin{equation} \label{eq:temp}
    m(k_i) = m(k_i \land k_j) + m(k_i \land \neg k_j).
  \end{equation}
  Applying \cref{eq:temp} and the equivalent expression for $m(k_j)$ allows us
  to rewrite \cref{eq:to_prove} as
  \begin{align*}
    m(k_i \land k_j) &= [m(k_i \land k_j) + m(k_i \land \neg k_j)] \cdot [m(k_i \land k_j) + m(\neg k_i \land k_j)] \\
                     &= m(k_i \land k_j)^2 + m(k_i \land k_j)[m(k_i \land \neg k_j) + m(\neg k_i \land k_j)] + m(k_i \land \neg k_j)m(\neg k_i \land k_j)
  \end{align*}
  Dividing both sides by $m(k_i \land k_j)$ gives
  \begin{equation} \label{eq:temp2}
    1 = m(k_i \land k_j) + m(k_i \land \neg k_j) + m(\neg k_i \land k_j) +
    \frac{m(k_i \land \neg k_j)m(\neg k_i \land k_j)}{m(k_i \land k_j)}.
  \end{equation}
  Since $k_i \land k_j \land k_i \land \neg k_j = 0$, and
  \[
    (k_i \land k_j) \lor (k_i \land \neg k_j) = k_i \land (k_j \lor \neg k_j) =
    k_i \land 1 = k_i,
  \]
  we have that
  \[
    m(k_i \land k_j) + m(k_i \land \neg k_j) = m(k_i).
  \]
  Similarly, $k_i \land \neg k_i \land k_j = 0$, and
  \[
    k_i \lor (\neg k_i \land k_j) = (k_i \lor \neg k_i) \land (k_i \lor k_j) =
    k_i \lor k_j,
  \]
  so
  \[
    m(k_i) + m(\neg k_i \land k_j) = m(k_i \lor k_j).
  \]
  Finally, note that
  \[
    (k_i \lor k_j) \land \neg(k_i \lor k_j) = 0,
  \]
  and
  \[
    (k_i \lor k_j) \lor \neg(k_i \lor k_j) = 1,
  \]
  so
  \[
    m(k_i \lor k_j) + m(\neg(k_i \lor k_j)) = m(1) = 1.
  \]
  This allows us to rewrite \cref{eq:temp2} as
  \[
    \frac{m(k_i \land \neg k_j)m(\neg k_i \land k_j)}{m(k_i \land k_j)} = 1 -
    m(k_i \lor k_j) = m(\neg(k_i \lor k_j)) = m(\neg k_i \land \neg k_j)
  \]
  which immediately gives us \cref{eq:to_prove2}.

  Now recall that $m = \nWMC$ and note that \cref{eq:to_prove2} can be
  multiplied by $\WMC(1)^2$ to turn the equation into one for $\WMC$ instead of
  $\nWMC$. Then
  \begin{align*}
    \WMC(k_i \land k_j) &= \sum_{\text{atoms } a \le k_i \land k_j} \WMC(a) = \sum_{\text{atoms } a \le k_i \land k_j} \prod_{m \in [n]} w(a_m) \\
                        &= \sum_{\text{atoms } a \le k_i \land k_j} w(a_i)w(a_j) \prod_{m \in [n] \setminus \{ i, j \}} w(a_m) = \sum_{\text{atoms } a \le k_i \land k_j} w(k_i)w(k_j) \prod_{m \in [n] \setminus \{ i, j \}} w(a_m) \\
    &= w(k_i)w(k_j) \sum_{\text{atoms } a \le k_i \land k_j} \prod_{m \in [n] \setminus \{ i, j \}} w(a_m) = w(k_i)w(k_j)C,
  \end{align*}
  where $C$ denotes the part of $\WMC(k_i \land k_j)$ that will be the same for
  $\WMC(\neg k_i \land k_j)$, $\WMC(k_i \land \neg k_j)$, and $\WMC(\neg k_i
  \land \neg k_j)$ as well. But then \cref{eq:to_prove2} becomes
  \[
    w(k_i)w(k_j)w(\neg k_i)w(\neg k_j)C^2 = w(k_i)w(\neg k_j)w(\neg k_i)w(k_j)C^2
  \]
  which is trivially true. By showing that WMC satisfies \cref{eq:to_prove2}, we
  also showed that it satisfies \cref{eq:to_prove}, finishing the second part of
  the proof.
\end{proof}
% TODO: the auxiliary result should be a 'claim' in-between the theorem and the proof.

\subsection{Extending the Algebra}

\subsubsection{Preliminaries}

\begin{definition}[\cite{givant2008introduction}]
  Let $\mathbf{A}$ and $\mathbf{B}$ be Boolean algebras. A \emph{Boolean
    homomorphism} from $\mathbf{A}$ to $\mathbf{B}$ is a map $f : \mathbf{A} \to
  \mathbf{B}$ such that:
  \begin{itemize}
  \item $f(x \land y) = f(x) \land f(y)$,
  \item $f(x \lor y) = f(x) \lor f(y)$,
  \item $f(\neg x) = \neg f(x)$
  \end{itemize}
  for all $x, y \in \mathbf{A}$.
\end{definition}

\begin{definition}[\cite{halmos2016algebraic}]
  Given two polyadic algebras $\mathbf{A}$ and $\mathbf{B}$, a \emph{polyadic
    homomorphism} from $\mathbf{A}$ to $\mathbf{B}$ is a Boolean homomorphism $f
  : \mathbf{A} \to \mathbf{B}$ such that
  \begin{itemize}
  \item $f\mathbf{S}(\tau)p = \mathbf{S}(\tau)fp$,
  \item $f\bm\exists(J)p = \bm\exists(J)fp$
  \end{itemize}
  for all $\tau \in T$, $p \in \mathbf{A}$, and $J \subseteq I$.
\end{definition}

\subsubsection{New Results}

A well-known way to overcome this limitation of independence is by adding more
literals \cite{DBLP:journals/ai/ChaviraD08}, i.e., extending the set $L$ covered
by the WMC weight function $w : L \to \mathbb{R}_{>0}$. Let us translate this
idea to the language of Boolean algebras.

\begin{theorem} \label{thm:extension} % TODO: cite the fact about atoms
  Let $\mathbf{B}$ be a finite Boolean algebra freely generated by some set of
  `literals' $L$, and let $m : \mathbf{B} \to \mathbb{R}_{\ge 0}$ be an
  arbitrary measure. We know that $\mathbf{B}$ has $n = 2^{|L|}$ atoms. Let
  $(a_i)_{i=1}^n$ denote those atoms in some arbitrary order. Let $L' = L \cup
  \{ \phi_i \mid i \in [n] \} \cup \{ \neg \phi_i \mid i \in [n] \}$ be the set
  $L$ extended with $2n$ new literals. Let $\mathbf{B'}$ be the unique Boolean
  algebra with
  \[
    \{ \phi_i \land a_i \mid i \in [n] \} \cup \{ \neg \phi_i \land a_i \mid i
    \in [n] \}
  \]
  as its set of atoms. Let $\iota : \mathbf{B} \to \mathbf{B'}$ be the inclusion
  homomorphism (i.e., $\iota(a) = a$ for all $a \in \mathbf{B}$). Let $w : L'
  \to \mathbb{R}_{> 0}$ be defined by
  \[
    w(l) = \begin{cases}
      \frac{m(a_i)}{2} & \text{if } l = \phi_i \text{ or } l = \neg\phi_i \text{
        for some } i \in [n] \\
      1 & \text{otherwise}
    \end{cases}
  \]
  for all $l \in L'$, and note that this defines a WMC measure $m' : \mathbf{B'}
  \to \mathbb{R}_{\ge 0}$. Then
  \[
    m(a) = (m' \circ \iota)(a)
  \]
  for all $a \in \mathbf{B}$.
\end{theorem}

In simpler terms, any measure can be computed using WMC by extending the Boolean
algebra with more literals. More precisely, we are given the red part in
\[
  \begin{tikzcd}
    \textcolor{red}{\mathbb{R}_{\ge 0}} & & \\
    \textcolor{red}{\mathbf{B}} \arrow[red]{u}{m} \arrow{r}{\iota} &
    \mathbf{B'} \arrow{lu}[swap]{m'} & \\
    \textcolor{red}{L} \arrow[Subset,red]{u}{} \arrow[Subset]{r}{} & L'
    \arrow[Subset]{u}{} \arrow{r}{w} & \mathbb{R}_{>0}
  \end{tikzcd}
\]
and construct the black part in such a way that the triangle commutes.

% TODO: make J depend on i
\begin{proof} % TODO: find a reference for this first claim
  Since $\mathbf{B}$ is freely generated by $L$, each atom $a_i \in \mathbf{B}$
  is an infimum of elements in $L$, i.e.,
  \[
    a_i = \bigwedge_{j \in J} a_{i,j}
  \]
  for some $\{ a_{i,j} \}_{j \in J} \subset L$. Moreover, each atom $b \in
  \mathbf{B'}$ can be represented as either
  \[
    b = \phi_i \land a_i \quad \text{or} \quad b = \neg\phi_i \land a_i
  \]
  for some atom $a_i \in \mathbf{B}$, also making it an infimum over a subset of
  $L'$. Then, for any $b \in \mathbf{B}$,
  \[
    (m' \circ \iota)(b) = \sum_{\substack{\text{atoms } a_i \in \mathbf{B}:\\
        \phi_i \land a_i \le \iota(b)}} (w(\phi_i) + w(\neg\phi_i)) \prod_{j \in
    J} w(a_{i,j}),
  \]
  recognising that, for any $\iota(b)$, any atom $a_i \in \mathbf{B}$ satisfies
  \[
    \phi_i \land a_i \le \iota(b)
  \]
  if and only if it satisfies
  \[
    \neg\phi_i \land a_i \le \iota(b).
  \]
  Then, according to the definition of $w$,
  \[
    (m' \circ \iota)(b) = \sum_{\substack{\text{atoms } a_i \in \mathbf{B}:\\
        \phi_i \land a_i \le \iota(b)}} (w(\phi_i) + w(\neg\phi_i)) =
    \sum_{\substack{\text{atoms } a_i \in \mathbf{B}:\\ \phi_i \land a_i \le
        \iota(b)}} m(a_i) = m(b),
  \]
  provided that
  \[
    \phi_i \land a_i \le \iota(b) \quad \text{if and only if} \quad a_i \le b,
  \]
  but this is equivalent to
  \[
    \phi_i \land a_i = \phi_i \land a_i \land b \quad \text{if and only if}
    \quad a_i = a_i \land b
  \]
  which is true because $\phi_i \not\in L$.
\end{proof}

Now we can show that the construction in \cref{thm:extension} is smallest
possible.

\begin{conjecture}
  Let $\mathbf{B}$ and $\mathbf{B'}$ be Boolean algebras, and $\iota :
  \mathbf{B} \to \mathbf{B'}$ be the inclusion map such that $\mathbf{B}$ is
  freely generated by $L$, all atoms of $\mathbf{B'}$ can be expressed as
  meets of elements of $L'$, and the following subset relations are satisfied:
  \[
    \begin{tikzcd}
      \mathbf{B} \arrow{r}{\iota} & \mathbf{B'} \\
      L \arrow[Subset]{u}{} \arrow[Subset]{r}{} & L' \arrow[Subset]{u}{}
    \end{tikzcd}
  \]
  If, for any measure $m : \mathbf{B} \to \mathbb{R}_{\ge 0}$, one can
  construct a weight function $w : L' \to \mathbb{R}_{>0}$ such that the WMC
  measure $\WMC : \mathbf{B'} \to \mathbb{R}_{\ge 0}$ with respect to $w$
  satisfies
  \[
    m = \WMC \circ \iota,
  \]
  then $|L' \setminus L| \ge 2^{|L|+1}$.
\end{conjecture}
% \begin{proof}
%   % 1. An atom in B' must have more than just elements of L.
%   Let $a$ be an atom in $\mathbf{B}$, and let $b$ be an atom in $\mathbf{B'}$
%   such that $b \le a$. First, let us notice that as long as $|L| \ge
%   4$\footnote{Note that $|L|$ has to be an even number.}, $b \ne a$. Indeed, let
%   $p, r, \neg p, \neg r \in L$. Then
%   \begin{align*}
%     (\WMC \circ \iota)(p \land r) &= w(p)w(r), \\
%     (\WMC \circ \iota)(p \land \neg r) &= w(p)w(\neg r), \\
%     (\WMC \circ \iota)(\neg p \land r) &= w(\neg p)w(r), \\
%     (\WMC \circ \iota)(\neg p \land \neg r) &= w(\neg p)w(\neg r), \\
%   \end{align*}
%   But then we have that
%   \[
%     \frac{m(p \land r)}{m(\neg p \land r)} = \frac{w(p)}{w(\neg p)} =
%     \frac{m(p \land \neg r)}{m(\neg p \land \neg r)}.
%   \]
%   This places a condition on $m$, contradicting the assumption that the
%   construction works for an arbitrary $m$. Hence $b < a$.

%   Second, we can show that if $b = a \land \bigwedge_{i = 1}^k \phi_i$ for some
%   positive integer $k$, then there must also be $2^k - 1$ other atoms in
%   $\mathbf{B'}$ that correspond to every possible way to negate a subset of
%   $\phi_i$'s, i.e., ranging from

%   % 2. If we add phi, then we must also add -phi.
%   % 3. Extension to multiple literals: we must have all (2^n) combinations of
%   % added literals).
%   % 4. Profit
% \end{proof}

Let us note how our lower bound on the number of added literals compares to two
methods of translating a discrete probability distribution into a WMC problem
over a propositional knowledge base proposed by Darwiche
\cite{DBLP:conf/kr/Darwiche02} and Sang et al. \cite{sang2005solving}. Suppose
we have a discrete probability distribution with  $n$ variables, and the $i$-th
variable has $v_i$ values, for each $i \in [n]$. Interpreted as a logical
system, it has $\prod_{i=1}^n v_i$ models. My expansion would then use
\[
  \sum_{i=1}^n v_i + 2\prod_{i=1}^n v_i
\]
variables, i.e., a variable for each possible variable-value assignment, and two
additional variables for each model. Without making any independence
assumptions, the encoding by Darwiche \cite{DBLP:conf/kr/Darwiche02} would use
\[
  \sum_{i=1}^n v_i + \sum_{i=1}^n \prod_{j=1}^i v_j
\]
variables, while for the encoding by Sang et al. \cite{sang2005solving},
\[
  \sum_{i=1}^n v_i + \sum_{i=1}^n (v_i - 1) \prod_{j=1}^{i-1} v_j
\]
variables would suffice.

\todo[inline,caption={}]{The big TODO list
  \begin{itemize}
  \item Extension to infinite (atomic?) Boolean algebras.
  \item Compare my polyadic measures with first-order WMC.
  \item Abstraction refinements as homomorphisms.
  \item Definition of a measure-preserving homomorphism from Jech's set theory
    book.
  \item A Boolean algebra is approximable if its Stone space is approximable.
  \end{itemize}
}

\bibliographystyle{plain}
\bibliography{paper}

\end{document}
